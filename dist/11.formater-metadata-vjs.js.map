{"version":3,"sources":["webpack:///src/components/formater-opensearch.vue","webpack:///./src/components/formater-opensearch.vue?9064","webpack:///./src/components/formater-opensearch.vue","webpack:///./src/components/formater-opensearch.vue?5bda"],"names":["components_formater_opensearchvue_type_script_lang_js_","name","props","describe","type","String","default","uuid","depth","Number","created","this","searchEventListener","handleSearch","bind","document","addEventListener","load","mounted","destroyed","removeEventListener","data","api","mappingParameters","osParameters","methods","_this","$http","get","then","response","extractDescribeParameters","body","loadWithProxy","_this2","$store","state","proxy","url","encodeURIComponent","$emit","console","log","extractParameter","parameterNode","specName","appName","object","value","Object","keys","find","key","parameters","predefined","getAttribute","obj","title","pattern","assign","min","max","nodes","getElementsByTagName","options","k","length","push","parametersString","DOMParser","parseFromString","firstChild","childNodes","forEach","node","tagName","toLowerCase","indexOf","extract","match","regexList","excluedRegex","i","some","str","RegExp","test","mapping","e","detail","parentUuid","component","componentNormalizer","_h","$createElement","_self","_c","__webpack_exports__"],"mappings":"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","file":"11.formater-metadata-vjs.js","sourcesContent":["/**\n * Tools to read the opensearch describe xml and extract the api and parameters \n * \n * @author epointal\n *\n **/\n \n<template></template>\n<script>\nfunction getKeyByValue(object, value) {\n  return Object.keys(object).find(key => object[key] === value);\n}\nexport default {\n  name: 'FormaterOpensearch',\n  props: {\n    describe: {\n      type: String,\n      default: null\n    },\n    uuid: {\n      type: String,\n      default: null\n    },\n    depth: {\n      type: Number,\n      default: null\n    }\n  },\n  created () {\n    this.searchEventListener = this.handleSearch.bind(this) \n  \tdocument.addEventListener('aerisSearchEvent', this.searchEventListener);\n    this.load()\n  },\n  mounted () {\n\n  },\n  destroyed () {\n    document.removeEventListener('aerisSearchEvent', this.searchEventListener);\n    this.searchEventListener = null\n  },\n  data () {\n    return {\n      searchEventListener: null,\n      api: null,\n      // associative array of: parameter name in this application => name in the opensearch api\n      // for the predefined parameters like box, temporalExtent, and paging (common for all api)\n      mappingParameters: [],\n      // list of others specific opensearch api parameters \n      // { name, title, pattern, min, max, options}\n      osParameters: []\n    }\n  },\n  methods: {\n     load() {\n       this.$http.get(this.describe)\n       .then(\n           response => { this.extractDescribeParameters(response.body);},\n           response => { this.loadWithProxy()}\n        )\n    },\n    loadWithProxy() {\n      if (this.$store.state.proxy.url) {\n\t      var url = this.$store.state.proxy.url + '?url=' + encodeURIComponent(this.describe)\n\t      this.$http.get(url)\n\t      .then(\n\t          response => { this.extractDescribeParameters(response.body);},\n\t          response => { this.$emit('failed');}\n\t       )\n      } else {\n        console.log('CAN NOT GET ' + this.describe)\n        this.$emit('failed')\n      }\n    },\n    extractParameter (parameterNode, specName) {\n      var listPredefined = this.$store.state.parameters.predefined\n      // name in this application\n      var appName = getKeyByValue(listPredefined, specName)\n      // name in the opensearch api\n      var name = parameterNode.getAttribute('name')\n      if (typeof appName !== 'undefined') {\n        this.mappingParameters[appName] = name\n        return\n      }\n      \n      var obj= {\n          name: name,\n          title: parameterNode.getAttribute('title')\n      }\n      // particular cas\n      switch(name) {\n        case 'relativeOrbitNumber':\n          obj.title = obj.title || 'Ex: 123'\n          break;\n        \n      }\n      \n      var pattern = parameterNode.getAttribute('pattern')\n      if (pattern) {\n        obj = Object.assign(obj, {pattern: pattern})\n      }\n      var min = parameterNode.getAttribute('minInclusive')\n      if (min) {\n        obj= Object.assign(obj, {min: min})\n      }\n      var max = parameterNode.getAttribute('maxInclusive')\n      if (max) {\n        obj = Object.assign(obj, {max: max})\n      }\n      var nodes = parameterNode.getElementsByTagName('parameters:Options')\n      if (nodes) {\n        var options= []\n        for(var k=0; k < nodes.length; k++) {\n          options.push(nodes[k].getAttribute('value'))\n        }\n        if (options.length > 0)\n        obj = Object.assign(obj, {options: options})\n      }\n//      if (self.removedFields.indexOf(name) >=0) {\n        \n//       }else if (name.toLowerCase() === 'platform') {\n//         this.platform = obj\n//       } else if (name.toLowerCase() === 'q'){\n//         this.hasQ = true\n//      } else\n//         if (this.geographic.indexOf(name) >=0) {\n//         this.geoParameters.push(obj)\n//       } else if (this.paging.indexOf(name) >= 0) {\n//          this.pagingParameters.push(obj)\n//       }else \n      if (!obj.options || obj.options.length > 1) {\n        this.osParameters.push(obj)\n      }\n    },\n    extractDescribeParameters(parametersString) {\n      var parser = new DOMParser()\n      var xml = parser.parseFromString(parametersString, 'text/xml')\n      var urls = xml.firstChild.childNodes\n      var url = null\n      // loop to find the good url\n      urls.forEach(function (node) {\n         if (node.tagName && node.tagName.toLowerCase() === 'url' && node.getAttribute('type').indexOf('json') >= 0) {\n           var template = node.getAttribute('template')\n           var extract = template.match(/^(.*(?:(?:search.json\\?)|(?:\\?format=FLATSIM))).*$/)\n           if( extract && extract[1] && extract[1] != ''){\n               url = node;\n           }\n         }\n      })\n      if (!url)  {\n        return\n      }\n      var template = url.getAttribute('template')\n      var extract = template.match(/^(.*(?:(?:search.json\\?)|(?:\\?format=FLATSIM))).*$/)\n      if (!extract[1]) {\n        return\n      } else {\n        this.api = extract[1]\n      }\n      var parameters = url.getElementsByTagName('parameters:Parameter')\n      var self = this\n      var regexList = this.$store.state.parameters.excluedRegex\n      // loop on the parameters node\n      for(var i=0; i < parameters.length; i++){\n        var specName = parameters[i].getAttribute('value')\n        // search if the parameter is exclued (@see list in store/index.js)\n        var isExclued = regexList.some(function(str) {\n          var rx = new RegExp(str)\n          return rx.test(specName)\n        })\n        if (!isExclued) {\n          var obj = self.extractParameter(parameters[i] , specName)\n        }\n        \n      }\n     // this.recordService()\n      this.$emit('parametersChange', {api: this.api, parameters:this.osParameters, mapping: this.mappingParameters})\n      \n    },\n    // record this service\n//     recordService() {\n//       // only if authenticate user\n//      // if (this.$store && this.$store.getters['user/email']) {\n//         this.$store.commit('services/add', this.api)\n//       // }\n//     },\n    handleSearch(e) {\n      if (this.api && e.detail.parentUuid === this.uuid) {\n        e.detail.api = this.api\n      }\n    }\n  }\n}\n\n</script>\n\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./formater-opensearch.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./formater-opensearch.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./formater-opensearch.vue?vue&type=template&id=0cc86130&\"\nimport script from \"./formater-opensearch.vue?vue&type=script&lang=js&\"\nexport * from \"./formater-opensearch.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c(\"div\")}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}