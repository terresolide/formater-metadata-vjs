{"version":3,"sources":["webpack:///src/formater-opensearch.vue","webpack:///./src/formater-opensearch.vue?6578","webpack:///./src/formater-opensearch.vue","webpack:///./src/formater-opensearch.vue?f7b2"],"names":["src_formater_opensearchvue_type_script_lang_js_","name","props","describe","type","String","default","uuid","depth","Number","created","this","searchEventListener","handleSearch","bind","document","addEventListener","load","destroyed","removeEventListener","data","api","mappingParameters","osParameters","methods","_this","$http","get","then","response","extractDescribeParameters","body","catch","loadWithProxy","_this2","url","$store","state","proxy","encodeURIComponent","extractParameter","parameterNode","specName","appName","object","value","Object","keys","find","key","parameters","predefined","getAttribute","obj","title","pattern","assign","min","max","nodes","getElementsByTagName","options","k","length","push","parametersString","DOMParser","parseFromString","firstChild","childNodes","forEach","node","tagName","toLowerCase","indexOf","extract","match","regexList","excluedRegex","i","some","str","RegExp","test","$emit","mapping","e","detail","parentUuid","component","componentNormalizer","_h","$createElement","_self","_c","__webpack_exports__"],"mappings":"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","file":"7.formater-metadata-vjs.js","sourcesContent":["/**\n * Tools to read the opensearch describe xml and extract the api and parameters \n * \n * @author epointal\n *\n **/\n \n<template></template>\n<script>\nfunction getKeyByValue(object, value) {\n  return Object.keys(object).find(key => object[key] === value);\n}\nexport default {\n  name: 'FormaterOpensearch',\n  props: {\n    describe: {\n      type: String,\n      default: null\n    },\n    uuid: {\n      type: String,\n      default: null\n    },\n    depth: {\n      type: Number,\n      default: null\n    }\n  },\n  created () {\n    this.searchEventListener = this.handleSearch.bind(this) \n  \tdocument.addEventListener('aerisSearchEvent', this.searchEventListener);\n    this.load()\n  },\n  destroyed () {\n    document.removeEventListener('aerisSearchEvent', this.searchEventListener);\n    this.searchEventListener = null\n  },\n  data () {\n    return {\n      searchEventListener: null,\n      api: null,\n      // associative array of: parameter name in this application => name in the opensearch api\n      // for the predefined parameters like box, temporalExtent, and paging (common for all api)\n      mappingParameters: [],\n      // list of others specific opensearch api parameters \n      // { name, title, pattern, min, max, options}\n      osParameters: []\n    }\n  },\n  methods: {\n     load() {\n       this.$http.get(this.describe)\n       .then(\n           response => { this.extractDescribeParameters(response.body);}\n        ).catch(function (response) {\n           // use proxy if core trouble\n           this.loadWithProxy()\n        })\n    },\n    loadWithProxy() {\n      var url = this.$store.state.proxy.url + '?url=' + encodeURIComponent(this.describe)\n      this.$http.get(url)\n      .then(\n          response => { this.extractDescribeParameters(response.body);}\n       )\n    },\n    extractParameter (parameterNode, specName) {\n      var listPredefined = this.$store.state.parameters.predefined\n      // name in this application\n      var appName = getKeyByValue(listPredefined, specName)\n      // name in the opensearch api\n      var name = parameterNode.getAttribute('name')\n      if (typeof appName !== 'undefined') {\n        this.mappingParameters[appName] = name\n        return\n      }\n      \n      var obj= {\n          name: name,\n          title: parameterNode.getAttribute('title')\n      }\n      \n      var pattern = parameterNode.getAttribute('pattern')\n      if (pattern) {\n        obj = Object.assign(obj, {pattern: pattern})\n      }\n      var min = parameterNode.getAttribute('minInclusive')\n      if (min) {\n        obj= Object.assign(obj, {min: min})\n      }\n      var max = parameterNode.getAttribute('maxInclusive')\n      if (max) {\n        obj = Object.assign(obj, {max: max})\n      }\n      var nodes = parameterNode.getElementsByTagName('parameters:Options')\n      if (nodes) {\n        var options= []\n        for(var k=0; k < nodes.length; k++) {\n          options.push(nodes[k].getAttribute('value'))\n        }\n        if (options.length > 0)\n        obj = Object.assign(obj, {options: options})\n      }\n//      if (self.removedFields.indexOf(name) >=0) {\n        \n//       }else if (name.toLowerCase() === 'platform') {\n//         this.platform = obj\n//       } else if (name.toLowerCase() === 'q'){\n//         this.hasQ = true\n//      } else\n//         if (this.geographic.indexOf(name) >=0) {\n//         this.geoParameters.push(obj)\n//       } else if (this.paging.indexOf(name) >= 0) {\n//          this.pagingParameters.push(obj)\n//       }else \n      if (!obj.options || obj.options.length > 1) {\n        this.osParameters.push(obj)\n      }\n    },\n    extractDescribeParameters(parametersString) {\n      var parser = new DOMParser()\n      var xml = parser.parseFromString(parametersString, 'text/xml')\n      var urls = xml.firstChild.childNodes\n      var url = null\n      // loop to find the good url\n      urls.forEach(function (node) {\n         if (node.tagName && node.tagName.toLowerCase() === 'url' && node.getAttribute('type').indexOf('json') >= 0) {\n           var template = node.getAttribute('template')\n           var extract = template.match(/^(.*(?:(?:search.json\\?)|(?:\\?format=FLATSIM))).*$/)\n           if( extract && extract[1] && extract[1] != ''){\n               url = node;\n           }\n         }\n      })\n      if (!url)  {\n        return\n      }\n      var template = url.getAttribute('template')\n      var extract = template.match(/^(.*(?:(?:search.json\\?)|(?:\\?format=FLATSIM))).*$/)\n      if (!extract[1]) {\n        return\n      } else {\n        this.api = extract[1]\n      }\n      var parameters = url.getElementsByTagName('parameters:Parameter')\n      var self = this\n      var regexList = this.$store.state.parameters.excluedRegex\n      // loop on the parameters node\n      for(var i=0; i < parameters.length; i++){\n        var specName = parameters[i].getAttribute('value')\n        // search if the parameter is exclued (@see list in store/index.js)\n        var isExclued = regexList.some(function(str) {\n          var rx = new RegExp(str)\n          return rx.test(specName)\n        })\n        if (!isExclued) {\n          var obj = self.extractParameter(parameters[i] , specName)\n        }\n        \n      }\n      this.$emit('parametersChange', {parameters:this.osParameters, mapping: this.mappingParameters})\n      \n    },\n    handleSearch(e) {\n      if (this.api && e.detail.parentUuid === this.uuid) {\n        e.detail.api = this.api\n      }\n    }\n  }\n}\n\n</script>\n\n","import mod from \"-!../node_modules/babel-loader/lib/index.js!../node_modules/vue-loader/lib/index.js??vue-loader-options!./formater-opensearch.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/babel-loader/lib/index.js!../node_modules/vue-loader/lib/index.js??vue-loader-options!./formater-opensearch.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./formater-opensearch.vue?vue&type=template&id=181fed8a&\"\nimport script from \"./formater-opensearch.vue?vue&type=script&lang=js&\"\nexport * from \"./formater-opensearch.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c(\"div\")}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}