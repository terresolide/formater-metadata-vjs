{"version":3,"sources":["webpack:///src/formater-opensearch.vue","webpack:///./src/formater-opensearch.vue?6578","webpack:///./src/formater-opensearch.vue","webpack:///./src/formater-opensearch.vue?ae7a"],"names":["src_formater_opensearchvue_type_script_lang_js_","name","props","describe","type","String","default","uuid","depth","Number","created","this","searchEventListener","handleSearch","bind","document","addEventListener","load","destroyed","removeEventListener","data","api","mappingParameters","osParameters","methods","_this","$http","get","then","response","extractDescribeParameters","body","catch","loadWithProxy","_this2","url","$store","state","proxy","encodeURIComponent","extractParameter","parameterNode","specName","appName","object","value","Object","keys","find","key","parameters","predefined","getAttribute","obj","title","pattern","assign","min","max","nodes","getElementsByTagName","options","k","length","push","parametersString","DOMParser","parseFromString","firstChild","childNodes","forEach","node","tagName","toLowerCase","indexOf","extract","match","regexList","excluedRegex","i","some","str","RegExp","test","$emit","mapping","e","detail","parentUuid","component","componentNormalizer","_h","$createElement","_self","_c","__webpack_exports__"],"mappings":"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","file":"7.formater-metadata-vjs.js","sourcesContent":["/**\r\n * Tools to read the opensearch describe xml and extract the api and parameters \r\n * \r\n * @author epointal\r\n *\r\n **/\r\n \r\n<template></template>\r\n<script>\r\nfunction getKeyByValue(object, value) {\r\n  return Object.keys(object).find(key => object[key] === value);\r\n}\r\nexport default {\r\n  name: 'FormaterOpensearch',\r\n  props: {\r\n    describe: {\r\n      type: String,\r\n      default: null\r\n    },\r\n    uuid: {\r\n      type: String,\r\n      default: null\r\n    },\r\n    depth: {\r\n      type: Number,\r\n      default: null\r\n    }\r\n  },\r\n  created () {\r\n    this.searchEventListener = this.handleSearch.bind(this) \r\n  \tdocument.addEventListener('aerisSearchEvent', this.searchEventListener);\r\n    this.load()\r\n  },\r\n  destroyed () {\r\n    document.removeEventListener('aerisSearchEvent', this.searchEventListener);\r\n    this.searchEventListener = null\r\n  },\r\n  data () {\r\n    return {\r\n      searchEventListener: null,\r\n      api: null,\r\n      // associative array of: parameter name in this application => name in the opensearch api\r\n      // for the predefined parameters like box, temporalExtent, and paging (common for all api)\r\n      mappingParameters: [],\r\n      // list of others specific opensearch api parameters \r\n      // { name, title, pattern, min, max, options}\r\n      osParameters: []\r\n    }\r\n  },\r\n  methods: {\r\n     load() {\r\n       this.$http.get(this.describe)\r\n       .then(\r\n           response => { this.extractDescribeParameters(response.body);}\r\n        ).catch(function (response) {\r\n           // use proxy if core trouble\r\n           this.loadWithProxy()\r\n        })\r\n    },\r\n    loadWithProxy() {\r\n      var url = this.$store.state.proxy.url + '?url=' + encodeURIComponent(this.describe)\r\n      this.$http.get(url)\r\n      .then(\r\n          response => { this.extractDescribeParameters(response.body);}\r\n       )\r\n    },\r\n    extractParameter (parameterNode, specName) {\r\n      var listPredefined = this.$store.state.parameters.predefined\r\n      // name in this application\r\n      var appName = getKeyByValue(listPredefined, specName)\r\n      // name in the opensearch api\r\n      var name = parameterNode.getAttribute('name')\r\n      if (typeof appName !== 'undefined') {\r\n        this.mappingParameters[appName] = name\r\n        return\r\n      }\r\n      \r\n      var obj= {\r\n          name: name,\r\n          title: parameterNode.getAttribute('title')\r\n      }\r\n      \r\n      var pattern = parameterNode.getAttribute('pattern')\r\n      if (pattern) {\r\n        obj = Object.assign(obj, {pattern: pattern})\r\n      }\r\n      var min = parameterNode.getAttribute('minInclusive')\r\n      if (min) {\r\n        obj= Object.assign(obj, {min: min})\r\n      }\r\n      var max = parameterNode.getAttribute('maxInclusive')\r\n      if (max) {\r\n        obj = Object.assign(obj, {max: max})\r\n      }\r\n      var nodes = parameterNode.getElementsByTagName('parameters:Options')\r\n      if (nodes) {\r\n        var options= []\r\n        for(var k=0; k < nodes.length; k++) {\r\n          options.push(nodes[k].getAttribute('value'))\r\n        }\r\n        if (options.length > 0)\r\n        obj = Object.assign(obj, {options: options})\r\n      }\r\n//      if (self.removedFields.indexOf(name) >=0) {\r\n        \r\n//       }else if (name.toLowerCase() === 'platform') {\r\n//         this.platform = obj\r\n//       } else if (name.toLowerCase() === 'q'){\r\n//         this.hasQ = true\r\n//      } else\r\n//         if (this.geographic.indexOf(name) >=0) {\r\n//         this.geoParameters.push(obj)\r\n//       } else if (this.paging.indexOf(name) >= 0) {\r\n//          this.pagingParameters.push(obj)\r\n//       }else \r\n      if (!obj.options || obj.options.length > 1) {\r\n        this.osParameters.push(obj)\r\n      }\r\n    },\r\n    extractDescribeParameters(parametersString) {\r\n      var parser = new DOMParser()\r\n      var xml = parser.parseFromString(parametersString, 'text/xml')\r\n      var urls = xml.firstChild.childNodes\r\n      var url = null\r\n      // loop to find the good url\r\n      urls.forEach(function (node) {\r\n         if (node.tagName && node.tagName.toLowerCase() === 'url' && node.getAttribute('type').indexOf('json') >= 0) {\r\n           var template = node.getAttribute('template')\r\n           var extract = template.match(/^(.*(?:(?:search.json\\?)|(?:\\?format=FLATSIM))).*$/)\r\n           if( extract && extract[1] && extract[1] != ''){\r\n               url = node;\r\n           }\r\n         }\r\n      })\r\n      if (!url)  {\r\n        return\r\n      }\r\n      var template = url.getAttribute('template')\r\n      var extract = template.match(/^(.*(?:(?:search.json\\?)|(?:\\?format=FLATSIM))).*$/)\r\n      if (!extract[1]) {\r\n        return\r\n      } else {\r\n        this.api = extract[1]\r\n      }\r\n      var parameters = url.getElementsByTagName('parameters:Parameter')\r\n      var self = this\r\n      var regexList = this.$store.state.parameters.excluedRegex\r\n      // loop on the parameters node\r\n      for(var i=0; i < parameters.length; i++){\r\n        var specName = parameters[i].getAttribute('value')\r\n        // search if the parameter is exclued (@see list in store/index.js)\r\n        var isExclued = regexList.some(function(str) {\r\n          var rx = new RegExp(str)\r\n          return rx.test(specName)\r\n        })\r\n        if (!isExclued) {\r\n          var obj = self.extractParameter(parameters[i] , specName)\r\n        }\r\n        \r\n      }\r\n      this.$emit('parametersChange', {parameters:this.osParameters, mapping: this.mappingParameters})\r\n      \r\n    },\r\n    handleSearch(e) {\r\n      if (this.api && e.detail.parentUuid === this.uuid) {\r\n        e.detail.api = this.api\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n","import mod from \"-!../node_modules/babel-loader/lib/index.js!../node_modules/vue-loader/lib/index.js??vue-loader-options!./formater-opensearch.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/babel-loader/lib/index.js!../node_modules/vue-loader/lib/index.js??vue-loader-options!./formater-opensearch.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./formater-opensearch.vue?vue&type=template&id=03388472&\"\nimport script from \"./formater-opensearch.vue?vue&type=script&lang=js&\"\nexport * from \"./formater-opensearch.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c(\"div\")}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }"],"sourceRoot":""}